(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{366:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("介绍")]),t._v(" "),s("p",[t._v("微信小程序项目打包上线流程")])]),t._v(" "),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("一个微信小程序项目经过构建，最终到完成上线时项目，最后一步便是分包。")]),t._v(" "),s("p",[t._v("分包的目的是为了进一步优化，以满足微信小程序上线和用户体验等，需要将小程序项目进行分包加载：即对小程序划分成不同的子包。")]),t._v(" "),s("p",[t._v("阅读微信官方文档（文档目录位置：开发/指南/基础能力/分包加载），可以发现官方对项目总大小和子包大小进行了限制。")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("文档引用")]),t._v(" "),s("p",[t._v("目前小程序分包大小有以下限制：")]),t._v(" "),s("ul",[s("li",[t._v("整个小程序所有分包大小不超过 20M")]),t._v(" "),s("li",[t._v("单个分包/主包大小不能超过 2M")])]),t._v(" "),s("p",[t._v("对小程序进行分包，可以优化小程序首次启动的下载时间，以及在多团队共同开发时可以更好的解耦协作。")])]),t._v(" "),s("p",[t._v("可以从上面官方原话看出，分包的目的不仅仅是因为官方对其做出了限制，同时是为了提升用户体验。")]),t._v(" "),s("p",[t._v("当用户在第一次使用某个小程序时，通常不需要一个其完整功能，而是浏览大致功能后再决定是否进行使用。在用户第一次使用时，用户会下载小程序文件到本地，才可以运行起来，这时候首次加载不会让感觉到卡顿、小程序体积庞大等，是至关重要的。")]),t._v(" "),s("p",[t._v("因此通过分包，划分主包，第一次只加载主包等关键子包，将会是一次至关重要的优化。")]),t._v(" "),s("p",[t._v("本文只针对最基本的分包进行教学，深入和一些细节需要自行阅读官方文档。")]),t._v(" "),s("h1",{attrs:{id:"打包流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#打包流程"}},[t._v("#")]),t._v(" 打包流程")]),t._v(" "),s("h2",{attrs:{id:"目录配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目录配置"}},[t._v("#")]),t._v(" 目录配置")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("官方假设目录")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("├── app.js\n├── app.json\n├── app.wxss\n├── packageA\n│   └── pages\n│       ├── cat\n│       └── dog\n│   └── assets\n│       └── images\n│   └── components\n│       └── tail\n├── packageB\n│   └── pages\n│       ├── apple\n│       └── banana\n├── pages\n│   ├── index\n│   └── logs\n└── utils\n")])])])]),t._v(" "),s("h2",{attrs:{id:"一、目录划分"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、目录划分"}},[t._v("#")]),t._v(" 一、目录划分")]),t._v(" "),s("ul",[s("li",[t._v("pages：主包")]),t._v(" "),s("li",[t._v("packageA、packageB：子包")])]),t._v(" "),s("p",[t._v("这里直接将需要划分为子包的在根目录下新建一个文件夹，然后在其内部创建 "),s("code",[t._v("pages")]),t._v(" ，把子包页面放在里面即可。")]),t._v(" "),s("p",[t._v("子包划分不限于 "),s("code",[t._v("pages")]),t._v(" ，同时 "),s("code",[t._v("component、assets")]),t._v(" 等都可以划分到里面。")]),t._v(" "),s("h2",{attrs:{id:"二、文件配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、文件配置"}},[t._v("#")]),t._v(" 二、文件配置")]),t._v(" "),s("p",[t._v("通过上面的文件结构划分 ，已经抽离出了主包和子包。具体抽离后的子包大小可以在微信小程序开发者工具右上角的 "),s("strong",[t._v("详情/基本信息/本地代码")]),t._v(" 中查看。")]),t._v(" "),s("p",[t._v("分包后，需要对子包中所有可能影响到的路径进行修改，避免路径错误。")]),t._v(" "),s("p",[t._v("随后，在 app.json "),s("code",[t._v("subpackages")]),t._v(" 字段声明项目分包结构")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pages"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pages/index"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pages/logs"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"subpackages"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"root"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"packageA"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pages"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pages/cat"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pages/dog"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"root"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"packageB"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pack2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pages"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pages/apple"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pages/banana"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("subpackages 各配置项说明")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("字段")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("root")]),t._v(" "),s("td",[t._v("String")]),t._v(" "),s("td",[t._v("分包根目录")])]),t._v(" "),s("tr",[s("td",[t._v("name")]),t._v(" "),s("td",[t._v("String")]),t._v(" "),s("td",[t._v("分包别名，"),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/preload.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("分包预下载"),s("OutboundLink")],1),t._v("时可以使用")])]),t._v(" "),s("tr",[s("td",[t._v("pages")]),t._v(" "),s("td",[t._v("StringArray")]),t._v(" "),s("td",[t._v("分包页面路径，相对于分包根目录")])]),t._v(" "),s("tr",[s("td",[t._v("independent")]),t._v(" "),s("td",[t._v("Boolean")]),t._v(" "),s("td",[t._v("分包是否独立分包")])])])])]),t._v(" "),s("p",[t._v("配置完后，我们发现，主包大小依旧过过于庞大。因此需要再对项目进行文件进行分隔。")]),t._v(" "),s("p",[t._v("首当其冲的，就是静态资源。在一个项目中，往往一个图片可能就比一个页面的代码文件还要大，因此对图片也进行必要的分包处理是必要的。")]),t._v(" "),s("p",[t._v("对静态资源进行分包后，子包目录结构理应如下：")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("子包目录结构")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("├── packageA\n│   └── pages\n│       ├── cat\n│       └── dog\n│   └── assets\n│       └── images\n│   └── components\n│       └── tail\n")])])])]),t._v(" "),s("h2",{attrs:{id:"三、压缩文件体积"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、压缩文件体积"}},[t._v("#")]),t._v(" 三、压缩文件体积")]),t._v(" "),s("p",[t._v("在借助第三方包的情况下，通常会使一个项目的体积变得庞大。而我们并不是需要每个包的所有功能，因此需要对导入的包不需要的部分进行删除，即进行体积压缩。")]),t._v(" "),s("p",[t._v("但是通常情况下，微信小程序并不会自动压缩包的体积，即无法自动做到按需引入。因此需要手动压缩包。")]),t._v(" "),s("p",[t._v("手动压缩方法：以 vant UI 为例，找到直接使用的组件在包的位置，其所在的文件夹不能删除，然后阅读其 js 和 json 文件，可以找到间接依赖的文件，那些文件所在的文件夹也不能删除。以此类推即可。")]),t._v(" "),s("p",[t._v("暂未知自动压缩或者更好的方法。")]),t._v(" "),s("h2",{attrs:{id:"四、版本上传"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、版本上传"}},[t._v("#")]),t._v(" 四、版本上传")]),t._v(" "),s("p",[t._v("分包就绪后，就可以上传小程序了。")]),t._v(" "),s("p",[t._v("上传方法：微信开发者工具右上角 "),s("strong",[t._v("上传")]),t._v(" ，点击后即可上传。")]),t._v(" "),s("p",[t._v("上传成功后，进入"),s("a",{attrs:{href:"https://mp.weixin.qq.com/wxamp/wacodepage/getcodepage?token=859243386&lang=zh_CN",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序开发网站"),s("OutboundLink")],1),t._v("。然后进入 管理/开发管理/开发版本 ，即可查看成功提交的版本信息。")])])}),[],!1,null,null,null);a.default=e.exports}}]);